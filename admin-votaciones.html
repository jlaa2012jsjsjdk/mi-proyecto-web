<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Votaciones | Vox Schola Admin</title>
    <link rel="stylesheet" href="estilos.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .admin-section { padding: 30px; background: #f8fafc; min-height: 100vh; }
        
        .creation-card {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            border: 1px solid #e2e8f0;
        }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-weight: bold; margin-bottom: 5px; color: #1e293b; }
        .form-group input { 
            width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 10px; outline: none;
        }

        .votes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .poll-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            border: 1px solid #e2e8f0;
            position: relative;
        }

        .poll-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: bold;
            background: #dcfce7;
            color: #166534;
            margin-bottom: 10px;
        }

        .btn-create {
            background: #2563eb; color: white; border: none; padding: 12px 25px;
            border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%;
        }

        .btn-delete-poll {
            background: #fee2e2; color: #ef4444; border: none; padding: 8px;
            border-radius: 8px; cursor: pointer; float: right;
        }
    </style>
</head>
<body style="background-color: #f8fafc;">

    <div class="app-container" style="display: flex;">
        <aside class="sidebar">
            <div class="logo"><i class="fas fa-user-shield"></i> Admin Panel</div>
            <nav class="nav-menu">
                <a href="admin-graficas.html" class="nav-link"><i class="fas fa-chart-pie"></i> Estad√≠sticas</a>
                <a href="admin-votaciones.html" class="nav-link active"><i class="fas fa-poll-h"></i> Votaciones</a>
                <a href="admin-finanzas.html" class="nav-link"><i class="fas fa-cash-register"></i> Finanzas</a>
                <a href="admin-buzon.html" class="nav-link"><i class="fas fa-inbox"></i> Buz√≥n de Quejas</a>
                <a href="admin-iniciativas.html" class="nav-link"><i class="fas fa-lightbulb"></i> Iniciativas</a>
                <a href="index.html" class="nav-link return-link">
    <i class="fas fa-arrow-left"></i> Volver al Sitio
</a>
                <div style="margin-top: 50px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px;">
                    <a href="index.html" class="nav-link" style="color: #f87171;"><i class="fas fa-arrow-left"></i> Salir al Sitio</a>
                </div>
            </nav>
        </aside>

        <main class="main-content" style="flex-grow: 1;">
            <div class="admin-section">
                <h1 style="color: #1e293b;">üó≥Ô∏è Control de Votaciones</h1>
                <p style="color: #64748b; margin-bottom: 30px;">Crea nuevas encuestas o elimina las vigentes.</p>

                <div class="creation-card">
                    <h3><i class="fas fa-plus-circle"></i> Nueva Votaci√≥n</h3>
                    <div class="form-group">
                        <label>T√≠tulo de la Propuesta</label>
                        <input type="text" id="pollTitle" placeholder="Ej: ¬øCambiar el men√∫ de la cafeter√≠a?">
                    </div>
                    <div class="form-group">
                        <label>Opci√≥n A</label>
                        <input type="text" id="optA" placeholder="Ej: S√≠, cambiarlo">
                    </div>
                    <div class="form-group">
                        <label>Opci√≥n B</label>
                        <input type="text" id="optB" placeholder="Ej: No, dejarlo igual">
                    </div>
                    <button class="btn-create" onclick="crearVotacion()">Lanzar Votaci√≥n</button>
                </div>

                <hr style="border: 0; border-top: 1px solid #e2e8f0; margin: 40px 0;">

                <h3>Votaciones Activas</h3>
                <div id="lista-votaciones" class="votes-grid">
                    <p>Cargando encuestas...</p>
                </div>
            </div>
        </main>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDfJOXMY6usthm_FfYmyOAn65aHSEQytMo",
            authDomain: "voxschola.firebaseapp.com",
            projectId: "voxschola",
            storageBucket: "voxschola.firebasestorage.app",
            messagingSenderId: "730366058404",
            appId: "1:730366058404:web:87dcb2f97265900b5f2b31"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        async function crearVotacion() {
            const titulo = document.getElementById('pollTitle').value;
            const a = document.getElementById('optA').value;
            const b = document.getElementById('optB').value;

            if(!titulo || !a || !b) return alert("Llena todos los campos");

            try {
                await db.collection("votaciones").add({
                    titulo: titulo,
                    opcionA: a,
                    opcionB: b,
                    votosA: 0,
                    votosB: 0,
                    creado: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert("Votaci√≥n creada!");
                location.reload();
            } catch(e) { console.error(e); }
        }

        async function cargarVotaciones() {
            const contenedor = document.getElementById('lista-votaciones');
            const snapshot = await db.collection("votaciones").orderBy("creado", "desc").get();
            
            contenedor.innerHTML = "";
            snapshot.forEach(doc => {
                const p = doc.data();
                contenedor.innerHTML += `
                    <div class="poll-card">
                        <button class="btn-delete-poll" onclick="borrarVotacion('${doc.id}')"><i class="fas fa-trash"></i></button>
                        <span class="poll-status">ACTIVA</span>
                        <h4>${p.titulo}</h4>
                        <p style="font-size: 0.9rem; color: #64748b;">
                            ${p.opcionA}: <strong>${p.votosA}</strong> votos<br>
                            ${p.opcionB}: <strong>${p.votosB}</strong> votos
                        </p>
                    </div>
                `;
            });
        }

        async function borrarVotacion(id) {
            if(confirm("¬øEliminar esta votaci√≥n?")) {
                await db.collection("votaciones").doc(id).delete();
                cargarVotaciones();
            }
        }

        window.onload = cargarVotaciones;
    </script>
</body>
</html>