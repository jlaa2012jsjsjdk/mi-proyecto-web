<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estad√≠sticas Globales | Vox Admin</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-dark: #0f172a; --card-dark: #1e293b;
            --neon-blue: #00f2ff; --neon-purple: #bc13fe;
            --neon-pink: #ff00ff; --neon-green: #10b981;
        }

        body { background-color: var(--bg-dark); color: white; font-family: 'Poppins', sans-serif; margin: 0; display: flex; }

        /* SIDEBAR COMPLETO RECUPERADO */
        .sidebar {
            width: 260px; background: #1e293b; height: 100vh; position: fixed;
            left: 0; top: 0; display: flex; flex-direction: column; padding: 20px;
            border-right: 2px solid var(--neon-purple); box-sizing: border-box; z-index: 100;
        }

        .logo { font-size: 1.5rem; font-weight: bold; color: var(--neon-blue); margin-bottom: 30px; text-shadow: 0 0 10px var(--neon-blue); text-align: center; }
        .nav-menu { display: flex; flex-direction: column; gap: 8px; flex-grow: 1; }
        .nav-link { color: #94a3b8; text-decoration: none; padding: 12px 15px; border-radius: 12px; display: flex; align-items: center; gap: 10px; transition: 0.3s; }
        .nav-link.active { background: rgba(188, 19, 254, 0.1); color: var(--neon-blue); border: 1px solid var(--neon-blue); }

        /* CONTENIDO AJUSTADO */
        .main-content { margin-left: 260px; flex-grow: 1; padding: 30px; background: radial-gradient(circle at top right, #1e1b4b, #0f172a); min-height: 100vh; }
        .header-stats { background: var(--card-dark); padding: 20px; border-radius: 20px; border: 1px solid var(--neon-blue); margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; }

        /* GRID PARA LAS 25 GR√ÅFICAS */
        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .chart-card { background: var(--card-dark); padding: 15px; border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.05); transition: 0.3s; }
        .chart-card:hover { border-color: var(--neon-purple); box-shadow: 0 0 20px rgba(188, 19, 254, 0.1); }
        .chart-wrapper { position: relative; width: 100%; height: 200px; }
        
        h4 { text-align: center; margin-bottom: 10px; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 1px; color: var(--neon-blue); height: 40px; display: flex; align-items: center; justify-content: center; }
        .btn-update { background: linear-gradient(90deg, var(--neon-blue), var(--neon-purple)); color: white; border: none; padding: 12px 25px; border-radius: 12px; cursor: pointer; font-weight: bold; }
    </style>
</head>

<body>

    <aside class="sidebar">
        <div class="logo"><i class="fas fa-user-shield"></i> ADMIN VOX</div>
        <nav class="nav-menu">
            <a href="admin-graficas.html" class="nav-link active"><i class="fas fa-chart-pie"></i> Estad√≠sticas</a>
            <a href="admin-votaciones.html" class="nav-link"><i class="fas fa-poll-h"></i> Votaciones</a>
            <a href="admin-finanzas.html" class="nav-link"><i class="fas fa-cash-register"></i> Finanzas</a>
            <a href="admin-buzon.html" class="nav-link"><i class="fas fa-inbox"></i> Buz√≥n</a>
            <a href="admin-iniciativas.html" class="nav-link"><i class="fas fa-lightbulb"></i> Iniciativas</a>
            <a href="admin-preguntas.html" class="nav-link"><i class="fas fa-question-circle"></i> Preguntas</a>
            <div style="margin-top: auto;"><a href="admin.html" class="nav-link" style="color: var(--neon-pink);"><i class="fas fa-arrow-left"></i> VOLVER</a></div>
        </nav>
    </aside>

    <main class="main-content">
        <div class="header-stats">
            <div>
                <h1 style="margin:0; font-size: 1.5rem;">üìä Inteligencia de Datos</h1>
                <p style="color: #94a3b8; margin:0;">An√°lisis completo de 25 puntos de mantenimiento.</p>
            </div>
            <button class="btn-update" onclick="cargarDatosAdmin()"><i class="fas fa-sync-alt"></i> SINCRONIZAR</button>
        </div>

        <div class="admin-grid" id="contenedor-graficas">
            </div>
    </main>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        if (localStorage.getItem("admin_access") !== "true") { window.location.href = "index.html"; }

        const firebaseConfig = {
            apiKey: "AIzaSyDfJOXMY6usthm_FfYmyOAn65aHSEQytMo",
            authDomain: "voxschola.firebaseapp.com",
            projectId: "voxschola",
            storageBucket: "voxschola.firebasestorage.app",
            messagingSenderId: "730366058404",
            appId: "1:730366058404:web:87dcb2f97265900b5f2b31"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        let misGraficas = [];
        const paleta = ['#00f2ff', '#bc13fe', '#ff00ff', '#10b981', '#facc15', '#f97316'];

        const listaPreguntas = [
            "¬øEn qu√© estado se encuentran los ba√±os hoy?",
            "¬øHay fugas de agua o llaves goteando?",
            "¬øC√≥mo consideras la iluminaci√≥n de tu sal√≥n?",
            "¬øLas paredes del sal√≥n necesitan pintura?",
            "¬øC√≥mo est√°n las canchas deportivas?",
            "¬øHas notado vidrios rotos o ventanas trabadas?",
            "¬øLas √°reas verdes est√°n bien cuidadas?",
            "¬øA qu√© hora notas que los botes de basura se llenan?",
            "¬øHay hormigas o insectos en el sal√≥n?",
            "¬øQu√© tan limpio est√° el patio despu√©s del recreo?",
            "¬øTu silla o banco est√° en buen estado?",
            "¬øHace mucho calor o fr√≠o dentro del sal√≥n?",
            "¬øLa comida de la cafeter√≠a se ve fresca?",
            "¬øHay suficientes mesas para comer?",
            "¬øTe sientes seguro en todas las √°reas de la escuela?",
            "¬øLos maestros mantienen el orden en el pasillo?",
            "¬øFuncionan los enchufes para conectar equipos?",
            "¬øC√≥mo calificar√≠as el mobiliario de la biblioteca?",
            "¬øHay suficientes botes de reciclaje?",
            "¬øQu√© deporte practicas m√°s en la escuela?",
            "¬øTe gustar√≠a que hubiera m√°s torneos inter-escolares?",
            "¬øC√≥mo es el trato del personal de limpieza?",
            "¬øHay ruido excesivo afuera de tu sal√≥n?",
            "¬øQu√© mejora es la m√°s urgente?",
            "¬øRecomendar√≠as esta escuela a un amigo?"
        ];

        async function cargarDatosAdmin() {
            misGraficas.forEach(g => g.destroy());
            misGraficas = [];
            const contenedor = document.getElementById('contenedor-graficas');
            contenedor.innerHTML = "";

            const snap = await db.collection("mantenimiento_reportes").get();
            const docs = snap.docs.map(d => d.data());

            listaPreguntas.forEach((pregunta, index) => {
                const idCanvas = `chart-${index}`;
                const card = document.createElement('div');
                card.className = 'chart-card';
                card.innerHTML = `<h4>${pregunta}</h4><div class="chart-wrapper"><canvas id="${idCanvas}"></canvas></div>`;
                contenedor.appendChild(card);

                const conteo = {};
                docs.forEach(d => {
                    if(d.pregunta === pregunta) {
                        conteo[d.respuesta] = (conteo[d.respuesta] || 0) + 1;
                    }
                });

                const ctx = document.getElementById(idCanvas).getContext('2d');
                const g = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(conteo),
                        datasets: [{
                            data: Object.values(conteo),
                            backgroundColor: paleta,
                            borderColor: '#1e293b',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } } 
                    }
                });
                misGraficas.push(g);
            });
        }

        window.onload = cargarDatosAdmin;
    </script>
</body>
</html>